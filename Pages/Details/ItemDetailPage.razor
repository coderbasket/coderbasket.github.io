@page "/details/{repo}"
#nullable disable
@*<ContentPage>
    <Content>
       
    </Content>
</ContentPage>
*@
<div>
    @if (Owner != null)
    {
        <div>
            <div class="row">
                <div class="clearfix">
                    <h3 class="title pull-left">@ProjectRepo.Title</h3>
                </div>
                <div class="separator-2"></div>
            </div>

            <div class="row">


                <div class="col-md-12">
                    <div class="description__section">
                        <div>
                            <img src="@Owner.GravatarImage()" class="circle pull-left author__gravatar" />
                            <div class="snppts-meta">
                                <span class="createdby">Created by</span>
                                <a href="/author/@Owner.GitHubHandle">
                                    <span class="author">
                                        @ProjectRepo.Repository.OwnerName

                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="description__section" style="color:@SiteInfo.TextColor">
                        <h5>Description</h5>
                        <span>@ProjectRepo.Description</span>
                    </div>
                    <div class="description__section">
                        <h5>Platforms</h5>
                        @if (this.ProjectRepo.Platform.Contains("Android"))
                        {
                            <i class="fa fa-android fa-2x"></i>
                        }
                        @if (this.ProjectRepo.Platform.Contains("iOS"))
                        {
                            <i class="fa fa-apple fa-2x"></i>
                        }
                        @if (this.ProjectRepo.Platform.Contains("Windows"))
                        {
                            <i class="fa fa-windows fa-2x"></i>
                        }
                        @if (this.ProjectRepo.Platform.Contains("Web"))
                        {
                            <i style="color:#1EBBEE" class="fa fa-internet-explorer fa-2x"></i>
                        }
                    </div>
                    @if (!string.IsNullOrEmpty(ProjectRepo.YoutubeUrl))
                    {
                        <a target="_blank" href="@ProjectRepo.YoutubeUrl" style="margin-bottom:25px;">
                            <div style="color:@SiteInfo.AccentColor; display:inline-flex;">
                                <i class="fa fa-youtube-play fa-2x"></i>
                                @*<h4 >Watch On Youtube</h4>*@
                            </div>
                        </a>
                    }
                    @if (ProjectRepo.ExternalUrl != null)
                    {
                        <div class="description__section">
                            <h5>External link</h5>
                            <a href="@ProjectRepo.ExternalUrl" target="_blank">Read more about this Snippet</a>
                        </div>
                    }
                    <div class="description__section">

                        <h5> Check out the code</h5>

                        @if (!string.IsNullOrEmpty(this.ProjectRepo.GitHubRepoInfo.ProjectName))
                        {
                            var repo = this.ProjectRepo.GitHubRepoInfo.ProjectUrl;
                           @* var vendorName = repo.Split('/')[0];
                            var repoName = repo.Split('/')[1];
                            var vendorUrl = "http://github.com/" + vendorName;
                            var repoUrl = "http://github.com/" + vendorName + '/' + repoName;*@

                            @if (!string.IsNullOrEmpty(jsonP))
                            {
                                var results = Newtonsoft.Json.JsonConvert.DeserializeObject<GithubRepoInformation>(jsonP);
                                if (string.IsNullOrEmpty(this.ProjectRepo.Description))
                                {
                                    this.ProjectRepo.Description = results.description;
                                }

                                var pushed_at = "Unknown";
                                DateTime date;
                                date = results.pushed_at;
                                pushed_at = date.ToString();
                                <div class="github-widget" data-repo="@ProjectRepo.GitHubRepoInfo.ProjectName">
                                    <div class="github-box repo">
                                        <div class="github-box-title">
                                            <h3>
                                                <a class="owner" href="@results.owner.html_url" title="@results.owner.html_url" target="_blank">@Owner.FirstName</a>
                                                <a class="repo" href="@ProjectRepo.ProjectUrl" title="@ProjectRepo.ProjectUrl" target="_blank">@ProjectRepo.GitHubRepoInfo.ProjectName</a>
                                            </h3>
                                            <div class="github-stats">
                                                <a class="watchers" href="@ProjectRepo.ProjectUrl/watchers" title="See watchers" target="_blank">@results.watchers</a>
                                                <a class="forks" href="@ProjectRepo.ProjectUrl/network/members" title="See forkers" target="_blank">@results.forks</a>
                                            </div>
                                        </div>
                                        <div class="github-box-content">
                                            <p class="description">
                                                <span style="color:@SiteInfo.TextColor">@results.description</span> &mdash; <a href="@ProjectRepo.ProjectUrl#readme" target="_blank">
                                                    Read
                                                    More
                                                </a>
                                            </p>
                                            <p class="link"><a href="@results.homepage"> @results.homepage</a></p>
                                        </div>
                                        <div class="github-box-download">
                                            <div class="updated" style="color:@SiteInfo.TextColor">
                                                Latest commit to the <strong style="color:@SiteInfo.AccentColor">@results.default_branch</strong> branch on <strong style="color:@SiteInfo.AccentColor">@pushed_at</strong>
                                            </div>
                                            <a class="download" target="_blank" style="color:@SiteInfo.AccentColor" href="@ProjectRepo.GitHubRepoInfo.DownloadZipUrl" title="Get an archive of this repository">Download as zip</a>

                                            <style type="text/css">
                                                .github-widget {
                                                    margin-top: 20px;
                                                }

                                                .github-box {
                                                    font-family: helvetica, arial, sans-serif;
                                                    font-size: 13px;
                                                    line-height: 18px;
                                                    background: #fafafa;
                                                    border: 1px solid #ddd;
                                                    color: #666;
                                                    border-radius: 3px;
                                                }

                                                    .github-box .github-box-title {
                                                        position: relative;
                                                        border-bottom: 1px solid #ddd;
                                                        border-radius: 3px 3px 0 0;
                                                        background: #fcfcfc;
                                                        background: -moz-linear-gradient(#fcfcfc, #ebebeb);
                                                        background: -webkit-linear-gradient(#fcfcfc, #ebebeb);
                                                    }

                                                        .github-box .github-box-title h3 {
                                                            word-wrap: break-word;
                                                            font-family: helvetica, arial, sans-serif;
                                                            font-weight: normal;
                                                            font-size: 16px;
                                                            color: @SiteInfo.AccentColor;
                                                            margin: 0;
                                                            padding: 10px 10px 10px 30px;
                                                            background-color: @SiteInfo.AccentColor;
                                                            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAXCAMAAAAx3e/WAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEQjIyNkJERkM0NjYxMUUxOEFDQzk3ODcxRDkzRjhCRSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEQjIyNkJFMEM0NjYxMUUxOEFDQzk3ODcxRDkzRjhCRSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkRCMjI2QkREQzQ2NjExRTE4QUNDOTc4NzFEOTNGOEJFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkRCMjI2QkRFQzQ2NjExRTE4QUNDOTc4NzFEOTNGOEJFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+dka2KgAAAEVQTFRFxMTEyMjI0tLSvb29vr6+zc3Ny8vLxcXFz8/P6enp3t7ex8fH0dHR1NTUw8PDwMDAzs7OvLy8wcHBu7u7v7+/zMzM////budQFwAAABd0Uk5T/////////////////////////////wDmQOZeAAAAcklEQVR42tSQSQ7DMAwD6chOukWs5eX/Ty2coo0T9wOdEzEgdRBuzNmnDofgja52JDyz5TCqUp0O6kfrb4bzSXkRiTviEZZ6JKLMJ5VQ2v8iGbtbfEwXmjFMG0VwdQo10hQNxYqtLMv9O6xvpZ/QeAkwAKjwHiJLaJc3AAAAAElFTkSuQmCC) 7px center no-repeat;
                                                            width: auto;
                                                        }

                                                    .github-box a {
                                                        color: @SiteInfo.AccentColor;
                                                        border: 0;
                                                        text-decoration: none;
                                                    }

                                                    .github-box .github-box-title h3 .repo {
                                                        font-weight: bold;
                                                    }

                                                    .github-box .github-box-title .github-stats {
                                                        float: right;
                                                        position: absolute;
                                                        top: 8px;
                                                        right: 10px;
                                                        font-size: 11px;
                                                        font-weight: bold;
                                                        line-height: 21px;
                                                        height: auto;
                                                        min-height: 21px;
                                                    }

                                                        .github-box .github-box-title .github-stats a {
                                                            display: inline-block;
                                                            height: 21px;
                                                            color: @SiteInfo.AccentDarkerColor;
                                                            border: 1px solid @SiteInfo.AccentColor;
                                                            border-radius: 3px;
                                                            padding: 0 5px 0 18px;
                                                            background: white url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAqCAMAAACEJ4viAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEQjIyNkJEQkM0NjYxMUUxOEFDQzk3ODcxRDkzRjhCRSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEQjIyNkJEQ0M0NjYxMUUxOEFDQzk3ODcxRDkzRjhCRSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkRCMjI2QkQ5QzQ2NjExRTE4QUNDOTc4NzFEOTNGOEJFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkRCMjI2QkRBQzQ2NjExRTE4QUNDOTc4NzFEOTNGOEJFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+h1kA9gAAAK5QTFRF+fn5sbGx8fHx09PTmpqa2dnZ/f3919fX9PT00NDQ1dXVpKSk+vr6+/v7vb298vLyycnJ8/PztLS0zc3N6enp/v7+q6ur2NjY9/f3srKy/Pz8p6en7u7uoaGhnJyc4eHhtbW1pqam6Ojo9fX17e3toqKirKys1NTUzs7Ox8fHwcHBwMDA5eXlnZ2dpaWl0dHR9vb25ubm4uLi3d3dqqqqwsLCv7+/oKCgmZmZ////8yEsbwAAAMBJREFUeNrE0tcOgjAUBuDSliUoMhTEvfdef9//xUQjgaLX0Ium/ZLT/+SkRPxZpGykvuf5VMJogy5jY9yjDHcWFhqlcRuHc4o6B1QK0BDg+hcZgNDh3NWTwzItH/bRrhvT+g3zSxZkNGCZpoWGIbU0a3Y6zV5VA6keyeDxiw62P0gUqEW0FbDim4nVikFJbU2zZXybUEaxhCqOQqyh5/G0wpWICUwthyqwD4InOMuXJ7/gs7WkoPdVg1vykF8CDACEFanKO3aSYwAAAABJRU5ErkJggg==) no-repeat;
                                                        }

                                                        .github-box .github-box-title .github-stats .forks {
                                                            background-position: -4px -21px;
                                                            padding-left: 15px;
                                                        }

                                                    .github-box .github-box-content {
                                                        padding: 10px;
                                                        font-weight: 300;
                                                    }

                                                        .github-box .github-box-content .link {
                                                            font-weight: bold;
                                                        }

                                                    .github-box .github-box-download {
                                                        position: relative;
                                                        border-top: 1px solid #ddd;
                                                        background: white;
                                                        border-radius: 0 0 3px 3px;
                                                        padding: 10px;
                                                        height: auto;
                                                        min-height: 24px;
                                                    }

                                                        .github-box .github-box-download .updated {
                                                            word-wrap: break-word;
                                                            margin: 0;
                                                            font-size: 11px;
                                                            color: #666;
                                                            line-height: 24px;
                                                            font-weight: 300;
                                                            width: auto;
                                                        }

                                                        .github-box .github-box-download .download {
                                                            float: right;
                                                            position: absolute;
                                                            top: 10px;
                                                            right: 10px;
                                                            height: 24px;
                                                            line-height: 24px;
                                                            font-size: 12px;
                                                            color: #666;
                                                            font-weight: bold;
                                                            text-shadow: 0 1px 0 rgb(255 255 255 / 90%);
                                                            padding: 0 10px;
                                                            border: 1px solid #ddd;
                                                            border-bottom-color: #bbb;
                                                            border-radius: 3px;
                                                            background: #f5f5f5;
                                                            background: -moz-linear-gradient(#f5f5f5, #e5e5e5);
                                                            background: -webkit-linear-gradient(#f5f5f5, #e5e5e5);
                                                        }
                                            </style>

                                        </div>

                                    </div>

                                </div>
                            }

                        }

                    </div>
                    @if (ProjectRepo.ImageUrls?.Count() > 0)
                    {
                        <div class="description__section">
                            <h5>Screenshots</h5>

                            <div class="row">
                                @foreach (var screenshot in ProjectRepo.ImageUrls)
                                {
                                    <div class="col-md-3 snippet__screenshot">
                                        <a href="@screenshot" target="_blank">
                                            <img src="@screenshot" alt="">
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</div>
@code {

    string jsonP = null;
    [Parameter]
    public string repo {get;set;}
    protected async override void OnInitialized()
    {
        base.OnInitialized();
        this.ProjectRepo = await DataServiceProvider.GetProjectItemAsync(repo);
        this.ProjectRepo = RepoHelper.LoadRepository(this.ProjectRepo);
        this.Owner = ProjectOwner.GetDefaultAuthor(this.ProjectRepo.GitHubRepoInfo);
        jsonP = await RepoHelper.GetJsonAsync(this.ProjectRepo);
        StateHasChanged();
    }

    [Parameter]
    public ProjectItem ProjectRepo { get; set; }
    [Parameter]
    public ProjectOwner Owner { get; set; }
}
